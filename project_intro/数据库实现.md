# 航旅服务平台 - 数据库实现

## 📊 数据库设计

### 1. 用户管理

#### 用户表(sys_user)
```sql
CREATE TABLE `sys_user` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `username` varchar(50) NOT NULL COMMENT '用户名',
  `password` varchar(100) NOT NULL COMMENT '密码',
  `real_name` varchar(50) DEFAULT NULL COMMENT '真实姓名',
  `id_card` varchar(18) DEFAULT NULL COMMENT '身份证号',
  `phone` varchar(11) DEFAULT NULL COMMENT '手机号',
  `email` varchar(100) DEFAULT NULL COMMENT '邮箱',
  `avatar` varchar(255) DEFAULT NULL COMMENT '头像',
  `status` tinyint(4) DEFAULT '1' COMMENT '状态：0-禁用，1-正常',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_username` (`username`),
  KEY `idx_phone` (`phone`),
  KEY `idx_email` (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

#### 角色表(sys_role)
```sql
CREATE TABLE `sys_role` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `role_name` varchar(50) NOT NULL COMMENT '角色名称',
  `role_code` varchar(50) NOT NULL COMMENT '角色编码',
  `description` varchar(255) DEFAULT NULL COMMENT '角色描述',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_role_code` (`role_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='角色表';
```

#### 用户角色关联表(sys_user_role)
```sql
CREATE TABLE `sys_user_role` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `user_id` bigint(20) NOT NULL COMMENT '用户ID',
  `role_id` bigint(20) NOT NULL COMMENT '角色ID',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_role` (`user_id`,`role_id`),
  KEY `idx_role_id` (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户角色关联表';
```

### 2. 航班管理

#### 航班表(flight)
```sql
CREATE TABLE `flight` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `flight_no` varchar(20) NOT NULL COMMENT '航班号',
  `airline` varchar(50) NOT NULL COMMENT '航空公司',
  `departure_city` varchar(50) NOT NULL COMMENT '出发城市',
  `arrival_city` varchar(50) NOT NULL COMMENT '到达城市',
  `departure_time` datetime NOT NULL COMMENT '出发时间',
  `arrival_time` datetime NOT NULL COMMENT '到达时间',
  `total_seats` int(11) NOT NULL COMMENT '总座位数',
  `available_seats` int(11) NOT NULL COMMENT '可用座位数',
  `price` decimal(10,2) NOT NULL COMMENT '价格',
  `status` tinyint(4) DEFAULT '1' COMMENT '状态：0-取消，1-正常',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_flight_no` (`flight_no`),
  KEY `idx_departure_city` (`departure_city`),
  KEY `idx_arrival_city` (`arrival_city`),
  KEY `idx_departure_time` (`departure_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='航班表';
```

#### 订单表(order)
```sql
CREATE TABLE `order` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `order_no` varchar(32) NOT NULL COMMENT '订单号',
  `user_id` bigint(20) NOT NULL COMMENT '用户ID',
  `flight_id` bigint(20) NOT NULL COMMENT '航班ID',
  `seat_count` int(11) NOT NULL COMMENT '座位数量',
  `total_amount` decimal(10,2) NOT NULL COMMENT '总金额',
  `status` tinyint(4) DEFAULT '0' COMMENT '状态：0-待支付，1-已支付，2-已取消',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_order_no` (`order_no`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_flight_id` (`flight_id`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单表';
```

### 3. 住宿管理

#### 酒店表(hotel)
```sql
CREATE TABLE `hotel` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `hotel_name` varchar(100) NOT NULL COMMENT '酒店名称',
  `city` varchar(50) NOT NULL COMMENT '所在城市',
  `address` varchar(255) NOT NULL COMMENT '详细地址',
  `star_level` tinyint(4) DEFAULT NULL COMMENT '星级',
  `description` text COMMENT '酒店描述',
  `images` text COMMENT '酒店图片，JSON数组',
  `status` tinyint(4) DEFAULT '1' COMMENT '状态：0-下架，1-上架',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_city` (`city`),
  KEY `idx_star_level` (`star_level`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='酒店表';
```

#### 房间表(room)
```sql
CREATE TABLE `room` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `hotel_id` bigint(20) NOT NULL COMMENT '酒店ID',
  `room_type` varchar(50) NOT NULL COMMENT '房间类型',
  `price` decimal(10,2) NOT NULL COMMENT '价格',
  `total_count` int(11) NOT NULL COMMENT '总数量',
  `available_count` int(11) NOT NULL COMMENT '可用数量',
  `description` text COMMENT '房间描述',
  `images` text COMMENT '房间图片，JSON数组',
  `status` tinyint(4) DEFAULT '1' COMMENT '状态：0-下架，1-上架',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_hotel_id` (`hotel_id`),
  KEY `idx_room_type` (`room_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='房间表';
```

## 🔍 索引设计

### 1. 主键索引
- 所有表使用自增主键
- 主键类型为bigint(20)
- 主键名统一为id

### 2. 唯一索引
- 用户名唯一索引
- 角色编码唯一索引
- 航班号唯一索引
- 订单号唯一索引

### 3. 普通索引
- 手机号索引
- 邮箱索引
- 城市索引
- 时间索引

## 🔄 数据库优化

### 1. 表结构优化
- 使用合适的字段类型
- 控制字段长度
- 添加必要的注释
- 使用utf8mb4字符集

### 2. 索引优化
- 遵循最左前缀原则
- 避免冗余索引
- 控制索引数量
- 定期维护索引

### 3. SQL优化
- 使用参数化查询
- 避免全表扫描
- 控制查询范围
- 使用合适的连接方式

## 📈 数据安全

### 1. 数据备份
- 定时全量备份
- 实时增量备份
- 多副本存储
- 异地备份

### 2. 数据加密
- 敏感数据加密
- 传输数据加密
- 密码加密存储
- 日志脱敏

### 3. 访问控制
- 最小权限原则
- 角色权限控制
- 操作日志记录
- 异常访问监控

## 🔧 数据库维护

### 1. 日常维护
- 定期检查表状态
- 优化表结构
- 清理历史数据
- 更新统计信息

### 2. 性能监控
- 慢查询监控
- 连接数监控
- 资源使用监控
- 异常监控

### 3. 故障处理
- 主从切换
- 数据恢复
- 性能调优
- 安全加固 