# èˆªæ—…æœåŠ¡å¹³å° - åç«¯å®ç°

## ğŸ›  æŠ€æœ¯æ ˆ

### 1. æ ¸å¿ƒæ¡†æ¶
- **Spring Boot 2.2.2** - åº”ç”¨æ¡†æ¶
- **MyBatis Plus 2.3** - ORMæ¡†æ¶
- **Apache Shiro** - å®‰å…¨æ¡†æ¶
- **Maven** - é¡¹ç›®ç®¡ç†

### 2. æ•°æ®åº“
- **MySQL** - ä¸»æ•°æ®åº“
- **Redis** - ç¼“å­˜ï¼ˆå¯é€‰ï¼‰

### 3. å·¥å…·åº“
- **FastJson** - JSONå¤„ç†
- **Apache POI** - Excelå¤„ç†
- **Hutool** - å·¥å…·åŒ…
- **ç™¾åº¦AI SDK** - äººå·¥æ™ºèƒ½æœåŠ¡

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
src/main/java/com/
â”œâ”€â”€ annotation/      # è‡ªå®šä¹‰æ³¨è§£
â”œâ”€â”€ config/          # é…ç½®ç±»
â”œâ”€â”€ controller/      # æ§åˆ¶å™¨
â”œâ”€â”€ dao/            # æ•°æ®è®¿é—®å±‚
â”œâ”€â”€ entity/         # å®ä½“ç±»
â”œâ”€â”€ interceptor/    # æ‹¦æˆªå™¨
â”œâ”€â”€ service/        # æœåŠ¡å±‚
â””â”€â”€ utils/          # å·¥å…·ç±»
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. ç”¨æˆ·è®¤è¯ä¸æˆæƒ

#### Shiroé…ç½®
```java
@Configuration
public class ShiroConfig {
    @Bean
    public ShiroFilterFactoryBean shiroFilterFactoryBean(SecurityManager securityManager) {
        ShiroFilterFactoryBean shiroFilterFactoryBean = new ShiroFilterFactoryBean();
        shiroFilterFactoryBean.setSecurityManager(securityManager);
        
        // é…ç½®æ‹¦æˆªå™¨é“¾
        Map<String, String> filterChainDefinitionMap = new LinkedHashMap<>();
        filterChainDefinitionMap.put("/api/auth/**", "anon");
        filterChainDefinitionMap.put("/api/**", "authc");
        
        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);
        return shiroFilterFactoryBean;
    }
}
```

#### ç™»å½•å®ç°
```java
@RestController
@RequestMapping("/api/auth")
public class AuthController {
    @Autowired
    private UserService userService;
    
    @PostMapping("/login")
    public Result login(@RequestBody LoginDTO loginDTO) {
        try {
            Subject subject = SecurityUtils.getSubject();
            UsernamePasswordToken token = new UsernamePasswordToken(
                loginDTO.getUsername(), 
                loginDTO.getPassword()
            );
            subject.login(token);
            return Result.success();
        } catch (AuthenticationException e) {
            return Result.error("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
        }
    }
}
```

### 2. èˆªç­ç®¡ç†

#### èˆªç­æŸ¥è¯¢
```java
@Service
public class FlightServiceImpl implements FlightService {
    @Autowired
    private FlightMapper flightMapper;
    
    @Override
    public Page<FlightVO> searchFlights(FlightSearchDTO searchDTO) {
        Page<Flight> page = new Page<>(searchDTO.getPage(), searchDTO.getLimit());
        
        LambdaQueryWrapper<Flight> wrapper = new LambdaQueryWrapper<>();
        wrapper.eq(StringUtils.isNotBlank(searchDTO.getDepartureCity()), 
                  Flight::getDepartureCity, searchDTO.getDepartureCity())
               .eq(StringUtils.isNotBlank(searchDTO.getArrivalCity()), 
                  Flight::getArrivalCity, searchDTO.getArrivalCity())
               .ge(searchDTO.getDepartureDate() != null, 
                  Flight::getDepartureTime, searchDTO.getDepartureDate());
               
        return flightMapper.selectPage(page, wrapper);
    }
}
```

#### è®¢å•å¤„ç†
```java
@Service
@Transactional(rollbackFor = Exception.class)
public class OrderServiceImpl implements OrderService {
    @Autowired
    private OrderMapper orderMapper;
    @Autowired
    private FlightService flightService;
    
    @Override
    public Result createOrder(OrderDTO orderDTO) {
        // 1. æ£€æŸ¥èˆªç­åº§ä½
        if (!flightService.checkSeats(orderDTO.getFlightId(), orderDTO.getSeatCount())) {
            return Result.error("åº§ä½ä¸è¶³");
        }
        
        // 2. åˆ›å»ºè®¢å•
        Order order = new Order();
        BeanUtils.copyProperties(orderDTO, order);
        order.setOrderNo(generateOrderNo());
        order.setStatus(OrderStatus.PENDING.getCode());
        
        // 3. ä¿å­˜è®¢å•
        orderMapper.insert(order);
        
        // 4. æ›´æ–°åº§ä½
        flightService.updateSeats(orderDTO.getFlightId(), orderDTO.getSeatCount());
        
        return Result.success(order);
    }
}
```

### 3. æ–‡ä»¶ä¸Šä¼ 

#### é…ç½®
```yaml
spring:
  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 10MB
```

#### å®ç°
```java
@RestController
@RequestMapping("/api/upload")
public class UploadController {
    @Value("${upload.path}")
    private String uploadPath;
    
    @PostMapping("/image")
    public Result uploadImage(@RequestParam("file") MultipartFile file) {
        try {
            // 1. æ£€æŸ¥æ–‡ä»¶ç±»å‹
            String contentType = file.getContentType();
            if (!contentType.startsWith("image/")) {
                return Result.error("åªæ”¯æŒå›¾ç‰‡ä¸Šä¼ ");
            }
            
            // 2. ç”Ÿæˆæ–‡ä»¶å
            String fileName = UUID.randomUUID().toString() + 
                            getFileExtension(file.getOriginalFilename());
            
            // 3. ä¿å­˜æ–‡ä»¶
            File dest = new File(uploadPath + fileName);
            file.transferTo(dest);
            
            return Result.success(fileName);
        } catch (IOException e) {
            return Result.error("ä¸Šä¼ å¤±è´¥");
        }
    }
}
```

### 4. ç¼“å­˜å®ç°

#### Redisé…ç½®
```java
@Configuration
@EnableCaching
public class RedisConfig {
    @Bean
    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {
        RedisTemplate<String, Object> template = new RedisTemplate<>();
        template.setConnectionFactory(factory);
        
        // è®¾ç½®keyçš„åºåˆ—åŒ–æ–¹å¼
        template.setKeySerializer(new StringRedisSerializer());
        // è®¾ç½®valueçš„åºåˆ—åŒ–æ–¹å¼
        template.setValueSerializer(new GenericJackson2JsonRedisSerializer());
        
        return template;
    }
}
```

#### ç¼“å­˜ä½¿ç”¨
```java
@Service
public class FlightServiceImpl implements FlightService {
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Cacheable(value = "flight", key = "#flightId")
    public FlightVO getFlightDetail(Long flightId) {
        return flightMapper.selectById(flightId);
    }
    
    @CacheEvict(value = "flight", key = "#flightId")
    public void updateFlight(FlightDTO flightDTO) {
        flightMapper.updateById(flightDTO);
    }
}
```

## ğŸ”’ å®‰å…¨å®ç°

### 1. æ¥å£å®‰å…¨
- **å‚æ•°éªŒè¯**
  - ä½¿ç”¨@Validæ³¨è§£
  - è‡ªå®šä¹‰éªŒè¯å™¨
  - ç»Ÿä¸€å¼‚å¸¸å¤„ç†

- **SQLæ³¨å…¥é˜²æŠ¤**
  - ä½¿ç”¨MyBatiså‚æ•°åŒ–æŸ¥è¯¢
  - è¾“å…¥è¿‡æ»¤
  - ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰

### 2. æ•°æ®å®‰å…¨
- **æ•æ„Ÿæ•°æ®åŠ å¯†**
  - å¯†ç åŠ å¯†å­˜å‚¨
  - ä¼ è¾“æ•°æ®åŠ å¯†
  - æ—¥å¿—è„±æ•

- **æƒé™æ§åˆ¶**
  - åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
  - æ•°æ®æƒé™æ§åˆ¶
  - æ“ä½œæ—¥å¿—è®°å½•

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®åº“ä¼˜åŒ–
- **ç´¢å¼•ä¼˜åŒ–**
  - åˆç†è®¾è®¡ç´¢å¼•
  - é¿å…ç´¢å¼•å¤±æ•ˆ
  - å®šæœŸç»´æŠ¤ç´¢å¼•

- **SQLä¼˜åŒ–**
  - é¿å…å…¨è¡¨æ‰«æ
  - ä½¿ç”¨æ‰¹é‡æ“ä½œ
  - åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–

### 2. ç¼“å­˜ä¼˜åŒ–
- **å¤šçº§ç¼“å­˜**
  - æœ¬åœ°ç¼“å­˜
  - Redisç¼“å­˜
  - ç¼“å­˜é¢„çƒ­

- **ç¼“å­˜ç­–ç•¥**
  - ç¼“å­˜æ›´æ–°
  - ç¼“å­˜ç©¿é€é˜²æŠ¤
  - ç¼“å­˜é›ªå´©é˜²æŠ¤

## ğŸ”„ éƒ¨ç½²æ–¹æ¡ˆ

### 1. ç¯å¢ƒé…ç½®
```yaml
spring:
  profiles:
    active: prod
  datasource:
    url: jdbc:mysql://localhost:3306/atsp
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
```

### 2. éƒ¨ç½²æ­¥éª¤
1. **ç¯å¢ƒå‡†å¤‡**
   - JDK 1.8
   - MySQL 5.7+
   - Redisï¼ˆå¯é€‰ï¼‰

2. **é¡¹ç›®æ‰“åŒ…**
   ```bash
   mvn clean package -Dmaven.test.skip=true
   ```

3. **éƒ¨ç½²è¿è¡Œ**
   ```bash
   java -jar atsp.jar --spring.profiles.active=prod
   ```

### 3. ç›‘æ§æ–¹æ¡ˆ
- **æ—¥å¿—ç›‘æ§**
  - ELKæ—¥å¿—æ”¶é›†
  - å¼‚å¸¸å‘Šè­¦
  - æ€§èƒ½ç›‘æ§

- **ç³»ç»Ÿç›‘æ§**
  - JVMç›‘æ§
  - çº¿ç¨‹ç›‘æ§
  - å†…å­˜ç›‘æ§ 